<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <title>VacinAí</title>

    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Css -->
    <link rel="stylesheet" href="./assets/styles/reset.css">
    <link rel="stylesheet" href="./assets/styles/main.css">
    <link rel="stylesheet" href="./assets/styles/vacina.css">
</head>

<body>
    <style>
        body {
            color: white;
        }
    </style>
    <header>
        <h1>VacinAí</h1>
        <p id="demo">Clique no botão para receber sua localização em Latitude e Longitude:</p>

        <button onclick="getLocation()">Permitir</button>
        <button onclick="backToHome()">Não permitir</button>
    </header>

    <div id="map"></div>

    <a class="btn" href="./estabelecimentos-descontos.html">Postos de vacinação</a>
    <a class="btn" href="./index.html">Voltar</a>

    <!-- Api -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBA5YYJQqGugyiDwoCcvEtIo6ivfzSpR5k&callback=initMap&libraries=&v=weekly"
        async>
        </script>


    <script>


        var x = document.getElementById("demo");
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            }
        }

        function showPosition(position) {
            x.innerHTML = "Latitude: " + position.coords.latitude +
                "<br>Longitude: " + position.coords.longitude;
        }

        function backToHome() {
            if (window.location.pathname = "./index.html") { }
        }

        let username = 'imunizacao_public';
        let password = 'qlto5t&7r_@+#Tlstigi';
        let url = "http://dados.recife.pe.gov.br/pt_BR/api/3/action/datastore_search";
        let headers = new Headers();

        let response = {};

        let data = new FormData();
        data.append("resource_id", 'dbf660d2-1ee5-451a-94ca-7c316e50d0ad');

        const InitMap = () => {
            // Initialize and add the map
            function initMap() {
                response.forEach(element => {
                    const latitide = element.latitude;
                    const longitude = element.longitude;
                    const title = element.local;
                    console.log(element);

                    // The map, centered at Uluru
                    const user = new google.maps.Map(document.getElementById("map"), {
                        position: { lat: position.coords.latitude, lng: position.coords.longitude },
                        zoom: 4,
                        center: uluru,
                    });

                    // The marker, positioned at Uluru
                    new google.maps.Marker({
                        position: { lat: latitide, lng: longitude },
                        map: map,
                        title: local
                    });
                });
            }
        }

        headers.append('Authorization', 'Basic' + (username + ":" + password));
        fetch(url, {
            method: "POST",
            body: data
        }).then((response) => response.json())
            .then((responseJson) => {
                response = responseJson.result.records;
                console.log(response);
                InitMap()
                // this.setState({
                //     data: responseJson
                // })
            })
            .catch((error) => {
                console.error(error);
            });

    </script>
</body>

</html>